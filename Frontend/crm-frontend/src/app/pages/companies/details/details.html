<div class="page-container">
  <mat-card class="company-card">
    <mat-card-header>
      <div mat-card-avatar>
        <mat-icon>business</mat-icon>
      </div>
      <mat-card-title>{{ company.name }}</mat-card-title>
      <mat-card-subtitle>{{ company.industry }}</mat-card-subtitle>
      <span class="spacer"></span>
      <button mat-stroked-button color="primary" (click)="editCompany()">
        <mat-icon>edit</mat-icon> Edit
      </button>
    </mat-card-header>

    <mat-card-content class="info-grid">
      <div class="info-item">
        <mat-icon>fingerprint</mat-icon>
        <div><label>NIP</label><span>{{ company.nip }}</span></div>
      </div>
      <div class="info-item">
        <mat-icon>language</mat-icon>
        <div><label>Website</label>{{ company.website }}</div>
      </div>
      <div class="info-item">
        <mat-icon>phone</mat-icon>
        <div><label>Phone</label><span>{{ company.phoneNumber }}</span></div>
      </div>
      <div class="info-item">
        <mat-icon>place</mat-icon>
        <div><label>Address</label><span>{{ company.address }}</span></div>
      </div>
    </mat-card-content>
  </mat-card>

  <div class="details-grid">
    <mat-card class="list-card">
      <mat-toolbar color="transparent">
        <span>Contacts</span>
        <span class="spacer"></span>
        <button mat-icon-button color="primary" (click)="addContact()">
          <mat-icon>person_add</mat-icon>
        </button>
      </mat-toolbar>
      
      <mat-card-content>
        <div class="custom-table">
          <header class="table-row head">
            <span>Name</span>
            <span>Position</span>
            <span class="action-cell"></span>
          </header>
          @for (contact of contacts; track contact.id) {
            <div class="table-row clickable" (click)="goToContact(contact.id)">
              <span class="bold">{{ contact.firstName }} {{ contact.lastName }}</span>
              <span class="text-secondary">{{ contact.position }}</span>
              <span class="action-cell">
                <mat-icon>chevron_right</mat-icon>
              </span>
            </div>
          } @empty {
            <p class="empty-state">No contacts found.</p>
          }
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="list-card">
      <mat-toolbar color="transparent">
        <span>Active Leads</span>
        <span class="spacer"></span>
        <button mat-icon-button color="accent" (click)="addLead()">
          <mat-icon>add_chart</mat-icon>
        </button>
      </mat-toolbar>

      <mat-card-content>
        <div class="custom-table">
          <header class="table-row head">
            <span>Title</span>
            <span class="text-center">Value</span>
            <span class="text-end">Stage</span>

          </header>

        </div>
        @for (lead of leads; track lead.id) {
        <div class="table-row clickable lead-grid" (click)="goToContact(lead.contactId)">
          <div class="lead-title-cell">
            <span class="bold">{{ lead.title }}</span>
            <small class="text-secondary">{{ lead.createdAt | date: 'dd.MM.yyyy'}}</small>
          </div>
          
          <span class="currency-value text-center">
            {{ lead.value }}
          </span>

          <div class="text-end">
            <span class="stage-badge" [class]="getStageClass(lead.stage)">
              {{ getStageName(lead.stage) }}
            </span>
          </div>
        </div>
      } @empty {
        <p class="empty-state">No active leads for this company.</p>
      }
      </mat-card-content>
    </mat-card>
  </div>
</div>